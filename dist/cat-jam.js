var t=(()=>{var t=Object.create,e=Object.defineProperty,n=Object.defineProperties,a=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertyNames,r=Object.getOwnPropertySymbols,o=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,c=(t,n,a)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,d=(t,e)=>{for(var n in e||(e={}))l.call(e,n)&&c(t,n,e[n]);if(r)for(var n of r(e))u.call(e,n)&&c(t,n,e[n]);return t},f=(t,e)=>n(t,i(e)),p=(t,e)=>function(){return e||(0,t[s(t)[0]])((e={exports:{}}).exports,e),e.exports},m=(t,n,i,r)=>{if(n&&"object"==typeof n||"function"==typeof n)for(let o of s(n))l.call(t,o)||o===i||e(t,o,{get:()=>n[o],enumerable:!(r=a(n,o))||r.enumerable});return t},h=(n,a,i)=>(i=null!=n?t(o(n)):{},m(!a&&n&&n.__esModule?i:e(i,"default",{value:n,enumerable:!0}),n)),g=(t,e,n)=>c(t,"symbol"!=typeof e?e+"":e,n),y=p({"spicetify-external:react"(t,e){e.exports=Spicetify.React}}),b=p({"spicetify-external:react-dom"(t,e){e.exports=Spicetify.ReactDOM}}),v={};((t,n)=>{for(var a in n)e(t,a,{get:n[a],enumerable:!0})})(v,{default:()=>mt});var x="catjam-webm",w="Bottom (Player)",S="Left (Library)",T="Track BPM",F="Advanced",M=[.425,.883,1.403,1.841,2.206,2.664,3.075,3.58,3.945,4.433,4.885,5.292,5.826,6.152,7.06,7.51,8.01,8.435,8.86,9.27],k=9.75,P=h(y()),R=h(b()),E={link:{id:"catjam-webm-link",label:"Custom webM video URL",type:"input",default:""},bpm:{id:"catjam-webm-bpm",label:"Custom default BPM",type:"number",default:135.48},position:{id:"catjam-webm-position",label:"Position",type:"dropdown",options:[w,S],default:w},bpmMethod:{id:"catjam-webm-bpm-method",label:"Lowering Method",type:"dropdown",options:[T,F],default:T},bpmMethodFaster:{id:"catjam-webm-bpm-method-faster-songs",label:"Faster Method",type:"dropdown",options:[T,F],default:T},size:{id:"catjam-webm-position-left-size",label:"Left Size (%)",type:"number",default:100}},C=new class{constructor(t,e,n={}){this.name=t,this.settingsId=e,this.initialSettingsFields=n,g(this,"settingsFields",this.initialSettingsFields),g(this,"stopHistoryListener"),g(this,"setRerender",null),g(this,"pushSettings",async()=>{var t,e;for(Object.entries(this.settingsFields).forEach(([t,e])=>{"button"!==e.type&&void 0===this.getFieldValue(t)&&this.setFieldValue(t,e.defaultValue)});!(null==(e=null==(t=null==Spicetify?void 0:Spicetify.Platform)?void 0:t.History)?void 0:e.listen);)await new Promise(t=>setTimeout(t,100));this.stopHistoryListener&&this.stopHistoryListener(),this.stopHistoryListener=Spicetify.Platform.History.listen(t=>{"/preferences"===t.pathname&&this.render()}),"/preferences"===Spicetify.Platform.History.location.pathname&&await this.render()}),g(this,"rerender",()=>{this.setRerender&&this.setRerender(Math.random())}),g(this,"render",async()=>{for(;!document.getElementById("desktop.settings.selectLanguage");){if("/preferences"!==Spicetify.Platform.History.location.pathname)return;await new Promise(t=>setTimeout(t,100))}const t=document.querySelector(".main-view-container__scroll-node-child main div");if(!t)return console.error("[spcr-settings] settings container not found");let e=Array.from(t.children).find(t=>t.id===this.settingsId);e?console.log(e):(e=document.createElement("div"),e.id=this.settingsId,t.appendChild(e)),R.default.render(P.default.createElement(this.FieldsContainer,null),e)}),g(this,"addButton",(t,e,n,a,i)=>{this.settingsFields[t]={type:"button",description:e,value:n,events:d({onClick:a},i)}}),g(this,"addInput",(t,e,n,a,i,s)=>{this.settingsFields[t]={type:"input",description:e,defaultValue:n,inputType:i,events:d({onChange:a},s)}}),g(this,"addHidden",(t,e)=>{this.settingsFields[t]={type:"hidden",defaultValue:e}}),g(this,"addToggle",(t,e,n,a,i)=>{this.settingsFields[t]={type:"toggle",description:e,defaultValue:n,events:d({onChange:a},i)}}),g(this,"addDropDown",(t,e,n,a,i,s)=>{this.settingsFields[t]={type:"dropdown",description:e,defaultValue:n[a],options:n,events:d({onSelect:i},s)}}),g(this,"getFieldValue",t=>{var e;return null==(e=JSON.parse(Spicetify.LocalStorage.get(`${this.settingsId}.${t}`)||"{}"))?void 0:e.value}),g(this,"setFieldValue",(t,e)=>{Spicetify.LocalStorage.set(`${this.settingsId}.${t}`,JSON.stringify({value:e}))}),g(this,"FieldsContainer",()=>{const[t,e]=(0,P.useState)(0);return this.setRerender=e,P.default.createElement("div",{className:"x-settings-section",key:t},P.default.createElement("h2",{className:"TypeElement-cello-textBase-type"},this.name),Object.entries(this.settingsFields).map(([t,e])=>P.default.createElement(this.Field,{nameId:t,field:e})))}),g(this,"Field",t=>{const e=`${this.settingsId}.${t.nameId}`;let n;if(n="button"===t.field.type?t.field.value:this.getFieldValue(t.nameId),"hidden"===t.field.type)return P.default.createElement(P.default.Fragment,null);const[a,i]=(0,P.useState)(n),s=e=>{void 0!==e&&(i(e),this.setFieldValue(t.nameId,e))};return P.default.createElement("div",{className:"x-settings-row"},P.default.createElement("div",{className:"x-settings-firstColumn"},P.default.createElement("label",{className:"TypeElement-viola-textSubdued-type",htmlFor:e},t.field.description||"")),P.default.createElement("div",{className:"x-settings-secondColumn"},"input"===t.field.type?P.default.createElement("input",f(d({className:"x-settings-input",id:e,dir:"ltr",value:a,type:t.field.inputType||"text"},t.field.events),{onChange:e=>{var n;s(e.currentTarget.value);const a=null==(n=t.field.events)?void 0:n.onChange;a&&a(e)}})):"button"===t.field.type?P.default.createElement("span",null,P.default.createElement("button",f(d({id:e,className:"Button-sc-y0gtbx-0 Button-small-buttonSecondary-useBrowserDefaultFocusStyle x-settings-button"},t.field.events),{onClick:e=>{var n;s();const a=null==(n=t.field.events)?void 0:n.onClick;a&&a(e)},type:"button"}),a)):"toggle"===t.field.type?P.default.createElement("label",{className:"x-settings-secondColumn x-toggle-wrapper"},P.default.createElement("input",f(d({id:e,className:"x-toggle-input",type:"checkbox",checked:a},t.field.events),{onClick:e=>{var n;s(e.currentTarget.checked);const a=null==(n=t.field.events)?void 0:n.onClick;a&&a(e)}})),P.default.createElement("span",{className:"x-toggle-indicatorWrapper"},P.default.createElement("span",{className:"x-toggle-indicator"}))):"dropdown"===t.field.type?P.default.createElement("select",f(d({className:"main-dropDown-dropDown",id:e},t.field.events),{onChange:e=>{var n;s(t.field.options[e.currentTarget.selectedIndex]);const a=null==(n=t.field.events)?void 0:n.onChange;a&&a(e)}}),t.field.options.map((t,e)=>P.default.createElement("option",{selected:t===a,value:e+1},t))):P.default.createElement(P.default.Fragment,null)))})}}("Cat-Jam Settings","catjam-settings"),B=new Proxy({},{get:(t,e)=>{const n=E[e];if(!n)return;const a=C.getFieldValue(n.id);if(null==a||""===a)return n.default;if("number"===n.type){const t=Number(a);return isNaN(t)?n.default:t}return a}});function A(t,e){var n,a;if(!t||0===t.length)return-60;let i=0,s=t.length-1,r=0;for(;i<=s;){r=i+s>>1;const n=t[r];if(n.start<=e&&n.start+n.duration>e)break;n.start>e?s=r-1:i=r+1}const o=t[r];if(!o)return-60;const l=e-o.start,u=o.loudness_max_time;if(l<u){const t=l/u;return o.loudness_start+t*(o.loudness_max-o.loudness_start)}{const e=(l-u)/(o.duration-u),i=null!=(a=null==(n=t[r+1])?void 0:n.loudness_start)?a:o.loudness_max;return o.loudness_max+e*(i-o.loudness_max)}}function L(t,e,n=6){if(!t||t.length<2)return 0;const a=e-n/2,i=e+n/2,s=t.filter(t=>t.start>=a&&t.start<=i);return s.length<2?0:60/((s[s.length-1].start-s[0].start)/(s.length-1))}function O(t){return Math.max(0,Math.min(1,(t- -60)/60))}var j=null;function I(){return j}function N(t){j=t}async function D(t=200,e=10){var n,a;const i=null==(a=null==(n=Spicetify.Player.data)?void 0:n.item)?void 0:a.uri;if(!i)return null;try{const t=`https://spclient.wg.spotify.com/audio-attributes/v1/audio-analysis/${i.split(":")[2]}?format=json`,e=await Spicetify.CosmosAsync.get(t);return N(e),e}catch(n){console.warn(`[CAT-JAM] Error fetching detailed analysis: ${n}`);try{const t=await Spicetify.getAudioData();return N(t),t}catch(n){return e>0?(await new Promise(e=>setTimeout(e,t)),D(t,e-1)):null}}}var $={high:.25,medium:.18,low:.1},_=new class{constructor(){this.state={playbackRate:1,currentBeatIndex:-1}}reset(){this.state={playbackRate:1,currentBeatIndex:-1}}update(t,e,n,a="high"){var i,s;if(!(null==(i=null==n?void 0:n.beats)?void 0:i.length))return{playbackRate:1};const r=n.beats,o=null!=(s=$[a])?s:$.high,l=k,u=M;let c=e%l;c<0&&(c=0);let d=-1;for(let e=r.length-1;e>=0;e--)if(r[e].start<=t){d=e;break}const f=this.findNextBeat(t,r);if(!f)return this.state.playbackRate=this.lerp(this.state.playbackRate,1,o),{playbackRate:this.state.playbackRate};const p=f.time-t;if(p<.005)return{playbackRate:this.state.playbackRate};const m=this.getTimeUntilNextDrop(c,u,l)/p,h=Math.max(.75,Math.min(1.35,m));return this.state.playbackRate=this.lerp(this.state.playbackRate,h,o),d!==this.state.currentBeatIndex&&(this.state.currentBeatIndex=d),{playbackRate:this.state.playbackRate}}findNextBeat(t,e){for(let n=0;n<e.length;n++)if(e[n].start>t)return{index:n,time:e[n].start};return null}getTimeUntilNextDrop(t,e,n){for(const n of e)if(n>t)return n-t;return n-t+e[0]}lerp(t,e,n){return t+(e-t)*n}getState(){return d({},this.state)}},z=new class{constructor(){this.frameTimes=[],this.lastFrameTime=0,this.frameCount=0,this.fpsUpdateTime=0,this.currentFPS=60,this.droppedTimestamps=[],this.measurementWindowMs=1e3,this.samplesCount=30}getPerformanceLevel(){return this.currentFPS<30?"low":this.currentFPS<50?"medium":"high"}getMetrics(){return{level:this.getPerformanceLevel(),fps:this.currentFPS,frameTime:this.lastFrameTime,droppedFrames:this.getDroppedFrames(),avgFrameTime:this.getAverageFrameTime()}}measureFrame(){const t=performance.now();if(this.lastFrameTime>0){const e=t-this.lastFrameTime;this.frameTimes.push(e);const n=Math.floor(e/16.67)-1;if(n>0&&e>50)for(let e=0;e<n;e++)this.droppedTimestamps.push(t);this.frameTimes.length>this.samplesCount&&this.frameTimes.shift()}this.lastFrameTime=t,this.frameCount++,t-this.fpsUpdateTime>=this.measurementWindowMs&&(this.currentFPS=1e3*this.frameCount/(t-this.fpsUpdateTime),this.frameCount=0,this.fpsUpdateTime=t)}getAverageFrameTime(){return 0===this.frameTimes.length?16.67:this.frameTimes.reduce((t,e)=>t+e,0)/this.frameTimes.length}getDroppedFrames(){const t=performance.now();return this.droppedTimestamps=this.droppedTimestamps.filter(e=>t-e<this.measurementWindowMs),this.droppedTimestamps.length}getThrottleInterval(){const t=this.getPerformanceLevel();return"low"===t?33.33:"medium"===t?16.67:0}shouldSkipFrame(){const t=this.getThrottleInterval();return 0!==t&&0!==this.frameTimes.length&&this.frameTimes[this.frameTimes.length-1]<t}reset(){this.frameTimes=[],this.lastFrameTime=0,this.frameCount=0,this.fpsUpdateTime=0,this.currentFPS=60,this.droppedTimestamps=[]}},H={maxBufferSize:8,maxAgeMs:100,interpolationThreshold:.02,maxJumpRate:.5,smoothFactor:.6},J=class{constructor(t=H){this.config=t,this.buffer=[],this.lastOutputRate=1,this.lastOutputTime=0}setConfig(t){this.config=t}push(t,e=performance.now()){this.buffer.push({rate:t,timestamp:e});const n=performance.now();for(this.buffer=this.buffer.filter(t=>n-t.timestamp<this.config.maxAgeMs);this.buffer.length>this.config.maxBufferSize;)this.buffer.shift()}getOutput(t=performance.now()){if(0===this.buffer.length)return{rate:this.lastOutputRate,isBuffered:!1,shouldSkip:!1};const e=this.buffer[this.buffer.length-1];if(1===this.buffer.length)return this.applyBufferLogic(e.rate,e.timestamp,t);const n=this.buffer[0];if(t-n.timestamp>this.config.maxAgeMs)return this.buffer.shift(),this.getOutput(t);const a=this.interpolate(n,e,t);return this.applyBufferLogic(a,n.timestamp,t)}interpolate(t,e,n){const a=e.timestamp-t.timestamp;if(a<=0)return e.rate;const i=n-t.timestamp,s=Math.min(1,Math.max(0,i/a));return t.rate+(e.rate-t.rate)*this.easeInOut(s)}easeInOut(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}applyBufferLogic(t,e,n){const a=Math.abs(t-this.lastOutputRate),i=n-e<50,s=this.buffer.length>1;if(i&&s&&a>this.config.interpolationThreshold){const e=this.lerp(this.lastOutputRate,t,this.config.smoothFactor);return a>this.config.maxJumpRate?{rate:this.lastOutputRate,isBuffered:!0,shouldSkip:!0}:(this.lastOutputRate=e,this.lastOutputTime=n,{rate:e,isBuffered:!0,shouldSkip:!1})}return this.lastOutputRate=t,this.lastOutputTime=n,{rate:t,isBuffered:s,shouldSkip:!1}}lerp(t,e,n){return t+(e-t)*n}clear(){this.buffer=[],this.lastOutputRate=1}getBufferSize(){return this.buffer.length}isStale(t=performance.now()){return 0===this.buffer.length||t-this.buffer[this.buffer.length-1].timestamp>500}},V=new J(H),U=new J({maxBufferSize:6,maxAgeMs:80,interpolationThreshold:.03,maxJumpRate:.4,smoothFactor:.5}),W=new J({maxBufferSize:4,maxAgeMs:60,interpolationThreshold:.05,maxJumpRate:.35,smoothFactor:.4});function q(t){return"low"===t?W:"medium"===t?U:V}var Y=null,X=!1,G=null,K={progressMs:0,perfLevel:"high",workerActive:!1},Q=k/M.length*1e3/2,Z=[],tt=-1;function et(t){return t.toFixed(3)+"x"}function nt(t){return"high"===t?"#4ade80":"medium"===t?"#facc15":"#f87171"}function at(t,e,n){return`\n\t\t<div style="display: flex; justify-content: space-between; padding: 1px 0;">\n\t\t\t<span style="color: rgba(255,255,255,0.5);">${t}</span>\n\t\t\t<span style="${n?`color: ${n}; font-weight: 600;`:"color: #fff;"}">${e}</span>\n\t\t</div>\n\t`}function it(t){return t?`\n\t\t\t<div style="\n\t\t\t\tmargin: 6px 0 4px;\n\t\t\t\tpadding: 3px 0;\n\t\t\t\tborder-top: 1px solid rgba(255,255,255,0.06);\n\t\t\t\tfont-size: 9px;\n\t\t\t\tcolor: rgba(255,255,255,0.3);\n\t\t\t\tletter-spacing: 1px;\n\t\t\t\ttext-transform: uppercase;\n\t\t\t">${t}</div>\n\t\t`:'<div style="margin: 4px 0; border-top: 1px solid rgba(255,255,255,0.06);"></div>'}function st(t){const e=M,n=k;let a=t%n;a<0&&(a+=n);let i=1/0;for(const t of e){const e=Math.abs(a-t),s=n-e;Math.min(e,s)<i&&(i=Math.min(e,s))}return i}function rt(){if(!X||!Y)return;const t=Y.querySelector("#catjam-debug-content");t&&(t.innerHTML=function(){var t,e,n,a,i,s,r,o,l,u,c,d,f,p;const{progressMs:m,perfLevel:h,workerActive:g}=K,y=m/1e3,b=I(),v=ut(),x=z.getMetrics(),w=q(h),S=null!=(t=null==v?void 0:v.playbackRate)?t:1,T=null!=(e=null==v?void 0:v.currentTime)?e:0;let F=-1;if(null==(n=null==b?void 0:b.beats)?void 0:n.length)for(let t=b.beats.length-1;t>=0;t--)if(b.beats[t].start<=y){F=t;break}const P=1e3*st(T),R=null!=(i=null==(a=null==b?void 0:b.beats)?void 0:a.length)?i:0;if(R>0&&F>=0&&F!==tt){tt=F;const t=1e3*st(T-(y-b.beats[F].start)*S);Z.push(t),Z.length>R&&Z.shift()}let E=it("PERFORMANCE");if(E+=at("FPS",x.fps.toFixed(1),nt(x.level)),E+=at("Profile",x.level.toUpperCase(),nt(x.level)),E+=at("Frame Time",x.avgFrameTime.toFixed(1)+"ms"),E+=at("Dropped Frames",String(x.droppedFrames),x.droppedFrames>10?"#f87171":void 0),E+=at("Worker",g?"ACTIVE":"MAIN THREAD",g?"#4ade80":"#facc15"),E+=it("SYNC ENGINE"),E+=at("Actual Rate",et(S)),void 0!==K.targetRate&&(E+=at("Target Rate",et(K.targetRate),"#60a5fa")),E+=at("Beat Index",String(F)),E+=at("Beat Drift",`${P.toFixed(1)}ms`,function(t){const e=Math.abs(t);return e<20?"#4ade80":e<50?"#facc15":"#f87171"}(P)),Z.length>0){const t=Z.reduce((t,e)=>t+Math.max(0,1-e/Q),0)/Z.length*100;E+=at("Beat Accuracy",`${t.toFixed(1)}% (last ${Z.length})`,t>=85?"#4ade80":t>=35?"#ffffff":t>=10?"#facc15":"#f87171")}if(E+=it("AUDIO ANALYSIS"),b){const t=null!=(r=null==(s=b.track)?void 0:s.tempo)?r:0,e=L(b.beats,y)||t;E+=at("Global BPM",t.toFixed(1)),E+=at("Local BPM",e.toFixed(1),e!==t?"#60a5fa":void 0);const n=A(b.segments,y),a=1+.1499999999999999*O(n);E+=at("Loudness",n.toFixed(1)+"dB"),E+=at("Scale",a.toFixed(3)+"x"),E+=at("Segments",String(null!=(l=null==(o=b.segments)?void 0:o.length)?l:0)),E+=at("Beats",String(null!=(c=null==(u=b.beats)?void 0:u.length)?c:0))}else E+=at("Status","No audio data","#f87171");if(E+=it("VIDEO"),v){E+=at("Video Time",v.currentTime.toFixed(3)+"s"),E+=at("Paused",v.paused?"YES":"NO",v.paused?"#f87171":"#4ade80");const t=M,e=t.find(t=>t>v.currentTime);E+=at("Next Head Drop",`in ${(1e3*(e?e-v.currentTime:k-v.currentTime+t[0])).toFixed(0)}ms`)}E+=it("RATE BUFFER"),E+=at("Buffer Size",`${w.getBufferSize()}`),E+=at("Stale",w.isStale()?"YES":"NO",w.isStale()?"#f87171":"#4ade80"),E+=it("PLAYBACK");const C=null!=(p=null==(f=null==(d=null==Spicetify?void 0:Spicetify.Player)?void 0:d.getDuration)?void 0:f.call(d))?p:0,B=Math.floor(m/6e4),j=Math.floor(m%6e4/1e3),N=Math.floor(C/6e4),D=Math.floor(C%6e4/1e3);return E+=at("Progress",`${B}:${String(j).padStart(2,"0")} / ${N}:${String(D).padStart(2,"0")}`),E}()),G=requestAnimationFrame(rt)}function ot(t){K=d(d({},K),t)}var lt=null;function ut(){return lt}function ct(t,e){lt&&(Spicetify.Player.isPlaying()?(_.reset(),lt.currentTime=0,lt.play()):lt.pause())}async function dt(){try{const e=B.position===w,n=k,a=`width: ${B.size}%; max-width: 300px; height: auto; max-height: 100%; position: absolute; bottom: 0; pointer-events: none; z-index: 1;`,i=e?".main-nowPlayingBar-right":".main-yourLibraryX-libraryItemContainer",s=e?"width: 65px; height: 65px;":a,r=await async function(t,e=50,n=100){for(let a=0;a<e;a++){const e=document.querySelector(t);if(e)return e;await new Promise(t=>setTimeout(t,n))}throw new Error(`Element ${t} not found.`)}(i);if(lt){lt.remove();const t=document.getElementById(x);t&&t.remove()}const o=B.link||"https://github.com/FixeQD/spicetify-cat-jam-synced-reborn/raw/main/src/resources/catjam.webm";(lt=document.createElement("video")).loop=!1,lt.autoplay=!1,lt.muted=!0,lt.style.cssText=s,lt.src=o,lt.id=x;const l=n-.15,u=()=>{lt&&lt.currentTime>=l&&(lt.currentTime=0)},c=()=>{lt&&(lt.currentTime=0,lt.play())};lt.addEventListener("timeupdate",u),lt.addEventListener("ended",c),(t=lt).style.pointerEvents="auto",t.addEventListener("click",t=>{t.shiftKey&&(t.preventDefault(),(X=!X)?(Y||(Y=function(){const t=document.createElement("div");return t.id="catjam-debug-overlay",t.style.cssText="\n\t\tposition: fixed;\n\t\ttop: 80px;\n\t\tleft: 20px;\n\t\tz-index: 99999;\n\t\tbackground: rgba(0, 0, 0, 0.88);\n\t\tcolor: #e0e0e0;\n\t\tfont-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', 'SF Mono', monospace;\n\t\tfont-size: 11px;\n\t\tline-height: 1.55;\n\t\tpadding: 0;\n\t\tborder-radius: 8px;\n\t\tborder: 1px solid rgba(255, 255, 255, 0.08);\n\t\tbackdrop-filter: blur(12px);\n\t\tbox-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);\n\t\tmin-width: 310px;\n\t\tuser-select: none;\n\t\tcursor: default;\n\t\tpointer-events: auto;\n\t",t.innerHTML='\n\t\t<div id="catjam-debug-header" style="\n\t\t\tpadding: 8px 12px;\n\t\t\tbackground: rgba(255, 255, 255, 0.04);\n\t\t\tborder-bottom: 1px solid rgba(255, 255, 255, 0.06);\n\t\t\tborder-radius: 8px 8px 0 0;\n\t\t\tcursor: grab;\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: space-between;\n\t\t">\n\t\t\t<span style="font-weight: 600; color: #fff; letter-spacing: 0.5px;">\n\t\t\t\tCat Jam Debug\n\t\t\t</span>\n\t\t\t<span style="\n\t\t\t\tfont-size: 9px;\n\t\t\t\tcolor: rgba(255, 255, 255, 0.35);\n\t\t\t\tletter-spacing: 0.3px;\n\t\t\t">v2.5.1 - drag to move</span>\n\t\t</div>\n\t\t<div id="catjam-debug-content" style="padding: 10px 12px;"></div>\n\t',function(t){const e=t.querySelector("#catjam-debug-header");if(!e)return;let n=!1,a=0,i=0;e.addEventListener("mousedown",s=>{0===s.button&&(n=!0,a=s.clientX-t.getBoundingClientRect().left,i=s.clientY-t.getBoundingClientRect().top,e.style.cursor="grabbing",s.preventDefault())}),document.addEventListener("mousemove",e=>{if(!n)return;const s=Math.max(0,Math.min(window.innerWidth-t.offsetWidth,e.clientX-a)),r=Math.max(0,Math.min(window.innerHeight-t.offsetHeight,e.clientY-i));t.style.left=`${s}px`,t.style.top=`${r}px`}),document.addEventListener("mouseup",()=>{n&&(n=!1,e.style.cursor="grab")})}(t),document.body.appendChild(t),t}()),Y.style.display="block",G=requestAnimationFrame(rt),console.log("[CAT-JAM] Debug overlay enabled")):(Y&&(Y.style.display="none"),G&&(cancelAnimationFrame(G),G=null),console.log("[CAT-JAM] Debug overlay disabled")))}),await D(),lt.playbackRate=1,_.reset(),r.firstChild?r.insertBefore(lt,r.firstChild):r.appendChild(lt),_.reset(),Spicetify.Player.isPlaying()?lt.play():lt.pause()}catch(t){console.error("[CAT-JAM] Initialization error: ",t)}var t}async function ft(){var t;for(console.log("[CAT-JAM] Extension initializing...");!(null==(t=null==Spicetify?void 0:Spicetify.Player)?void 0:t.addEventListener)||!(null==Spicetify?void 0:Spicetify.getAudioData);)await new Promise(t=>setTimeout(t,100));Object.values(E).forEach(t=>{"input"===t.type||"number"===t.type?C.addInput(t.id,t.label,String(t.default)):"dropdown"===t.type&&C.addDropDown(t.id,t.label,t.options,0)}),C.addButton("catjam-reload","Reload","Save and reload",()=>{dt()}),C.pushSettings(),await dt();let e=null,n=null,a=!1;try{const t=new Blob([`(${(()=>{const t=M,e=k,n={high:.25,medium:.18,low:.1};let a=1,i=-1;function s(t,e,n){return t+(e-t)*n}self.onmessage=r=>{const{type:o,data:l}=r.data;if("process"===o&&l.audioData){const r=function(r,o,l,u="high"){const c=r/1e3,d=function(r,o,l,u){var c,d;if(!(null==(c=null==l?void 0:l.beats)?void 0:c.length))return 1;const f=l.beats,p=null!=(d=n[u])?d:n.high;let m=o%e;m<0&&(m=0);let h=-1;for(let t=f.length-1;t>=0;t--)if(f[t].start<=r){h=t;break}const g=function(t,e){for(let n=0;n<e.length;n++)if(e[n].start>t)return{index:n,time:e[n].start};return null}(r,f);if(!g)return a=s(a,1,p),a;const y=g.time-r;if(y<.005)return a;const b=function(n){for(const e of t)if(e>n)return e-n;return e-n+t[0]}(m),v=(x=b/y,Math.max(.75,Math.min(1.35,x)));var x;return a=s(a,v,p),h!==i&&(i=h),a}(c,o,l,u),f=function(t,e){var n,a;if(!t||0===t.length)return-60;let i=0,s=t.length-1,r=0;for(;i<=s;){r=i+s>>1;const n=t[r];if(n.start<=e&&n.start+n.duration>e)break;n.start>e?s=r-1:i=r+1}const o=t[r];if(!o)return-60;const l=e-o.start,u=o.loudness_max_time;if(l<u){const t=l/u;return o.loudness_start+t*(o.loudness_max-o.loudness_start)}{const e=(l-u)/(o.duration-u),i=null!=(a=null==(n=t[r+1])?void 0:n.loudness_start)?a:o.loudness_max;return o.loudness_max+e*(i-o.loudness_max)}}(l.segments,c);return{playbackRate:d,scale:1+Math.max(0,Math.min(1,(f+60)/60))*(1.15-1)}}(l.progressMs,l.videoTime,l.audioData,l.perfLevel);self.postMessage({type:"result",data:r})}"resetRate"===o&&(a=1,i=-1)}}).toString()})()`],{type:"application/javascript"});n=new Worker(URL.createObjectURL(t)),a=!0,n.onmessage=t=>{const{type:e,data:n}=t.data;if("result"===e&&ut()){const t=ut(),e=q(z.getPerformanceLevel());e.push(n.playbackRate,performance.now());const a=e.getOutput();a.shouldSkip||(t.playbackRate=a.rate),t.style.transform=`scale(${n.scale})`,ot({targetRate:n.playbackRate})}}}catch(t){console.warn("[CAT-JAM] Worker setup failed, falling back to main thread:",t),n=null}const i=(s=async t=>{var s,r,o;if(!Spicetify.Player.isPlaying())return e=null,void(null==(s=ut())||s.pause());const l=Spicetify.Player.getProgress(),u=z.getPerformanceLevel();if(ot({progressMs:l,perfLevel:u,workerActive:!(!n||!a)}),n&&a){const t=I();if(t){const e=null!=(o=null==(r=ut())?void 0:r.currentTime)?o:0;n.postMessage({type:"process",data:{progressMs:l,audioData:t,perfLevel:u,videoTime:e}})}}else{!function(t,e="high"){if(!lt)return;const n=function(t,e="high"){var n;if(!lt)return 1;const a=I();if(!(null==(n=null==a?void 0:a.beats)?void 0:n.length))return 1;const i=t/1e3,s=lt.currentTime;return _.update(i,s,a,e).playbackRate}(t,e);lt.playbackRate=n}(l,u);const{loudness:t}=function(t){var e;if(!j)return{playbackRate:1,loudness:.5};const n=t/1e3,a=B.bpm,i=L(j.beats,n)||(null==(e=j.track)?void 0:e.tempo)||a;return{playbackRate:i/a,loudness:O(A(j.segments,n)),bpm:i}}(l),e=ut();if(e){const n=1+.1499999999999999*t;e.style.transform=`scale(${n})`,ot({targetRate:e.playbackRate})}}e=requestAnimationFrame(i)},t=>{z.measureFrame(),s()});var s;const r=()=>{e||(e=requestAnimationFrame(i))};Spicetify.Player.addEventListener("onplaypause",()=>{Spicetify.Player.getProgress(),ct(performance.now()),Spicetify.Player.isPlaying()?r():(null==n||n.postMessage({type:"resetRate"}),q("high").clear(),q("medium").clear(),q("low").clear())});let o=0;Spicetify.Player.addEventListener("onprogress",()=>{const t=Spicetify.Player.getProgress();Math.abs(t-o)>=3e3&&(ct(performance.now()),null==n||n.postMessage({type:"resetRate"}),q("high").clear(),q("medium").clear(),q("low").clear()),o=t}),Spicetify.Player.addEventListener("songchange",async()=>{var t;const e=ut();if(!e)return;q("high").clear(),q("medium").clear(),q("low").clear(),Z=[],tt=-1;const n=performance.now(),a=await D();if(e.playbackRate=1,null==(t=null==a?void 0:a.beats)?void 0:t.length){const t=a.beats[0].start,e=Math.max(0,1e3*t-(performance.now()-n));setTimeout(()=>{var t;null==(t=ut())||t.play(),r()},e)}else e.play(),r()}),Spicetify.Player.isPlaying()&&r()}var pt,mt=ft;return ft(),pt=v,m(e({},"__esModule",{value:!0}),pt)})();